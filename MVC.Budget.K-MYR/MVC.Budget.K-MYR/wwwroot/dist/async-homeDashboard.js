"use strict";(self.webpackChunkthebudgeteer=self.webpackChunkthebudgeteer||[]).push([[245],{904:(e,t,a)=>{a.d(t,{default:()=>d});var n=a(501),i=a(933),r=a(681),o=a(438),s=a(17);n.Chart.register(n.ju,n.Bs);class d{#e;#t;#a;#n;#i;#r;#o;#s;#d;#c;#m;constructor(e,t,a,n){this.#e=n,this.#m=e,this.#l(t,a)}async#l(e,t){try{this.#t=!0;var a=this.#h(e,t),n=this.#g();this.#r=document.getElementById("home-overspending"),this.#o=document.getElementById("incomeBalanceHeader"),this.#s=document.getElementById("incomeAccordionBody"),this.#d=document.getElementById("expensesBalanceHeader"),this.#c=document.getElementById("expensesAccordionBody"),this.#u(),this.#y(),await a,await n}finally{this.#t=!1}}attachMenuHandlers(){var e=this.#e.incomeCategories.concat(this.#e.expenseCategories);for(let t=0;t<e.length;t++){let a=e[t],n=document.getElementById(`category_${a.id}`);n&&(n.addEventListener("click",this.#p),n.addEventListener("keydown",this.#p),n.addEventListener("animationend",this.#C),n.addEventListener("animationcancel",this.#C))}}#p=e=>{if("click"===e.type||"keydown"===e.type&&"Enter"===e.key){var t=e.currentTarget,a=t.dataset.id;0!=this.#m.dataset.categoryid&&document.getElementById(`category_${this.#m.dataset.categoryid}`).querySelector(".border-animation").classList.remove("border-rotate");var n=e.pageX,i=e.pageY;if(void 0===n||void 0===i){let e=t.getBoundingClientRect();n=e.left+e.width/2,i=e.top+e.height/2}i=Math.max(Math.min(i-100,window.innerHeight-200),66),n=Math.max(Math.min(n-100,window.innerWidth-220),20),this.#m.dataset.categoryid=a,this.#m.style.left=`${n}px`,this.#m.style.top=`${i}px`,this.#m.classList.add("active"),t.querySelector(".border-animation").classList.add("border-rotate")}};#C=e=>{var t;console.log(e),"fading-out"===e.animationName&&((t=e.currentTarget).removeEventListener("animationend",this.#C),t.removeEventListener("animationcancel",this.#C),t.removeEventListener("click",this.#p),t.removeEventListener("keydown",this.#p),t.remove()),"fading-in"===e.animationName&&(t=e.currentTarget).classList.remove("fading-in")};async#h(e,t){this.#a=await(0,i.nz)("#home-monthSelector","month"),this.#a.datepicker("setDate",t.toISOString()),this.#a.on("changeDate",(async()=>{this.#b(e,this.#a.datepicker("getUTCDate"))})),s(".monthPicker .calendar-button").on("click",(function(){var e=s(this).siblings(".monthSelector");e.data("datepicker").picker.is(":visible")?e.datepicker("hide"):e.datepicker("show")}))}#g(){var e={responsive:!0,layout:{padding:2},maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(e){var t=e.dataset.label||"";return t&&(t+=": "),null!==e.parsed.y&&(t+=window.userNumberFormat.format(e.parsed)),t}}}}},t=document.getElementById("sentimentChart");this.#n=new n.Chart(t,{type:"doughnut",data:{labels:["Happy","Unhappy"],datasets:[{label:"Total Amount",data:[this.#e.expensesHappyTotal,this.#e.expensesTotal-this.#e.expensesHappyTotal],backgroundColor:["rgb(25,135,84)","rgb(220,53,69)"],hoverOffset:4}]},options:e});var a=document.getElementById("necessityChart");this.#i=new n.Chart(a,{type:"doughnut",data:{labels:["Necessary","Unnecessary"],datasets:[{label:"Total Amount",data:[this.#e.expensesNecessaryTotal,this.#e.expensesTotal-this.#e.expensesNecessaryTotal],backgroundColor:["rgb(25,135,84)","rgb(220,53,69)"],hoverOffset:4}]},options:e})}async#b(e,t){try{this.#t&&o.A.addAndShow("The dashboard is loading...","#info-icon"),this.#t=!0;let a=await this.#v(e,t);a.isSuccess?this.#f(a.data):(o.A.addMessage({text:a.message,iconId:"#cross-icon"}),o.A.show())}finally{this.#t=!1}}async#v(e,t){return await(0,r.$g)(e,t)}formatDashboard(e){try{if(this.#t)return o.A.addAndShow("The dashboard is loading...","#info-icon"),!1;this.#t=!0,this.#u(e),this.#y(e),this.#x(e)}finally{this.#t=!1}}#y(e){if(null==(e??this.#e))return!1;var t=this.#e.incomeCategories.concat(this.#e.expenseCategories);for(let e=0;e<t.length;e++)this.#w(t[e]);return!0}#w(e){if(!e)return!1;if(document.getElementById(`category_${e.id}_balance`).textContent=`${window.userNumberFormat.format(e.total)} / \n            ${window.userNumberFormat.format(e.budget)}`,e.total>e.budget){let t=e.total-e.budget;document.getElementById(`category_${e.id}_deviationText`).textContent=1===e.categoryType?`Surplus: ${window.userNumberFormat.format(t)}`:`Overspending: ${window.userNumberFormat.format(t)}`}return!0}#x(e){var t=e??this.#e;return null!=t&&(this.#n.data.datasets[0].data=[t.expensesHappyTotal,t.expensesTotal-t.expensesHappyTotal,Number.MIN_VALUE],this.#n.update(),this.#i.data.datasets[0].data=[t.expensesNecessaryTotal,t.expensesTotal-t.expensesNecessaryTotal,Number.MIN_VALUE],this.#i.update(),!0)}#u(e){var t=e??this.#e;return null!=t&&(this.#r.textContent=`Overspending: ${window.userNumberFormat.format(t.overspending)}`,this.#o.textContent=`${window.userNumberFormat.format(t.incomeTotal)} / ${window.userNumberFormat.format(t.incomeBudget)}`,this.#d.textContent=`${window.userNumberFormat.format(t.expensesTotal)} / ${window.userNumberFormat.format(t.expensesBudget)}`,!0)}#f(e){var t=e??this.#e;return null!=t&&(this.#x(t),this.#u(t),this.#T(t.incomeCategories),this.#T(t.expenseCategories),!0)}#T(e){if(0==e.length)return!1;for(let t=0;t<e.length;t++)this.#E(e[t]);return!0}#E(e){if(!e)return!1;var t=document.getElementById(`category_${e.id}`);if(!t)return this.addCategory(e),!0;document.getElementById(`category_${e.id}_name`).textContent=decodeURIComponent(e.name);var a=e.budgetLimit?.budget??e.budget,n=document.getElementById(`category_${e.id}_progressbar`),i=document.getElementById(`category_${e.id}_balance`);i.textContent=`${window.userNumberFormat.format(e.total)} / \n            ${window.userNumberFormat.format(a)}`;var r=document.getElementById(`category_${e.id}_deviation`);if(e.total>a){let n,o=e.total-a;if(r)n=r.querySelector(`#category_${e.id}_deviationText`);else{let a=t.querySelector(".category-body");(r=document.createElement("div")).className="category-body-content deviation",r.id=`category_${e.id}_deviation`,n=document.createElement("span"),n.id=`category_${e.id}_deviationText`,n.className="deviation-text",r.appendChild(n),a.insertBefore(r,i.parentElement)}n.textContent=1===e.categoryType?`Surplus: ${window.userNumberFormat.format(o)}`:`Overspending: ${window.userNumberFormat.format(o)}`}else r&&r.remove();var o=a>0?Math.min(100,Math.floor(100*e.total/a)):100,s="bg-success";return 2==e.categoryType&&(s=o<50?"bg-success":o<85?"bg-warning":"bg-danger"),n.className=`progress-bar ${s}`,n.style.width=`${o}%`,n.ariaValuenow=`${o}`,!0}#N(e){var t=document.createElement("div");t.id=`category_${e.id}`,t.className="category fading-in",t.dataset.id=`${e.id}`,t.tabIndex=0,t.addEventListener("click",this.#p),t.addEventListener("keydown",this.#p),t.addEventListener("animationend",this.#C),t.addEventListener("animationcancel",this.#C);var a=document.createElement("div");a.className="border-container";var n=document.createElement("div");n.className="content";var i=document.createElement("div");i.className="category-body";var r=document.createElement("div");r.id=`category_${e.id}_name`,r.className="category-body-content",r.textContent=decodeURIComponent(e.name);var o=e.budgetLimit?.budget??e.budget,s=document.createElement("div");s.className="category-body-content balance";var d=document.createElement("span");if(d.id=`category_${e.id}_balance`,d.className="balance-text",d.textContent=`${window.userNumberFormat.format(e.total)} / \n            ${window.userNumberFormat.format(o)}`,s.appendChild(d),i.appendChild(r),e.total>e.budget){let t=e.total-e.budget,a=document.createElement("div");a.className="category-body-content deviation",a.id=`category_${e.id}_deviation`;let n=document.createElement("span");n.id=`category_${e.id}_deviationText`,n.className="deviation-text",n.textContent=1===e.categoryType?`Surplus: ${window.userNumberFormat.format(t)}`:`Overspending: ${window.userNumberFormat.format(t)}`,a.appendChild(n),i.appendChild(a)}i.appendChild(s);var c=document.createElement("div");c.className="progress";var m=o>0?Math.min(100,Math.floor(100*e.total/o)):100,l="bg-success";2==e.categoryType&&(l=m<50?"bg-success":m<85?"bg-warning":"bg-danger");var h=document.createElement("div");h.id=`category_${e.id}_progressbar`,h.className=`progress-bar ${l}`,h.role="progressbar",h.style.width=`${m}%`,h.ariaValuenow=`${m}`,h.ariaValuemin="0",h.ariaValuemax="100",h.setAttribute("aria-labelledby",`category_${e.id}_balance`),c.appendChild(h),n.appendChild(i),n.appendChild(c);var g=document.createElement("div");return g.className="border-animation",a.appendChild(n),a.appendChild(g),t.appendChild(a),t}getCategory(e){return this.#e.incomeCategories.concat(this.#e.expenseCategories).find((t=>t.id==e))}addCategory(e){var t={id:e.id,name:e.name,budget:e.budget,categoryType:e.categoryType,happyTotal:0,necessaryTotal:0,total:0};1===e.categoryType?this.#e.incomeBudget+=e.budget:2===e.categoryType&&(this.#e.expensesBudget+=e.budget);var a=this.#N(t),n=1==t.categoryType?this.#s:this.#c,i=1==t.categoryType?this.#e.incomeCategories:this.#e.expenseCategories,r=i.findIndex((e=>t.name.localeCompare(e.name)<0));-1===r?(i.push(t),n.appendChild(a)):(i.splice(r,0,t),n.insertBefore(a,n.children[r])),this.#x(),this.#u()}editCategory(e,t){var a,n=parseInt(e.get("Type")),i=parseInt(e.get("Id")),r=e.get("Name"),o=parseFloat(e.get("Budget"));switch(n){case 1:a=this.#e.incomeCategories;break;case 2:a=this.#e.expenseCategories;break;default:return!1}var s=a.find((e=>e.id===i));if(!s)return!1;var d=s.budgetLimit?.budget??s.budget;if(s.name!=r||d!=o){if(d!=o){let e=Math.max(0,s.total-d),a=Math.max(0,s.total-o)-e;switch(this.#e.overspending+=a,n){case 1:this.#e.incomeBudget+=o-d;break;case 2:this.#e.expensesBudget+=o-d;break;default:return!1}this.#u(),s.budgetLimit={budget:o,month:t}}s.name=r,this.#E(s)}}removeCategory(e,t){var a,n=document.getElementById(`category_${e}`);switch(n&&n.classList.add("fading-out"),t){case 1:a=this.#e.incomeCategories;break;case 2:a=this.#e.expenseCategories;break;default:return!1}var i=a.findIndex((t=>t.id===e));if(-1!==i){let e=a[i];1===t?(this.#e.incomeTotal-=e.total,this.#e.incomeBudget-=e.budget):2===t&&(this.#e.overspending-=Math.max(0,e.total-e.budget),this.#e.expensesTotal-=e.total,this.#e.expensesBudget-=e.budget,this.#e.expensesHappyTotal-=e.happyTotal,this.#e.expensesNecessaryTotal-=e.necessaryTotal),a.splice(i,1),this.#x(),this.#u()}return!0}addTransaction(e){var t=new Date(e.dateTime),a=t.getYear(),n=t.getMonth(),i=this.getCurrentMonthUTC(),r=i.getYear(),o=i.getMonth();if(a===r&&n==o){let t=this.#e.incomeCategories.concat(this.#e.expenseCategories).find((t=>t.id===e.categoryId)),a=Math.max(0,t.total-t.budget);t.total+=e.amount,this.#e.overspending+=Math.max(0,t.total-t.budget-a),2===t.categoryType?(this.#e.expensesTotal+=e.amount,e.isHappy&&(this.#e.expensesHappyTotal+=e.amount),e.isNecessary&&(this.#e.expensesNecessaryTotal+=e.amount)):1===t.categoryType&&(this.#e.incomeTotal+=e.amount),e.isHappy&&(t.happyTotal+=e.amount),e.isNecessary&&(t.necessaryTotal+=e.amount),this.#u(),this.#x(),this.#E(t)}}getCurrentMonthUTC=()=>this.#a.datepicker("getUTCDate");getCurrentMonth=()=>this.#a.datepicker("getDate")}}}]);