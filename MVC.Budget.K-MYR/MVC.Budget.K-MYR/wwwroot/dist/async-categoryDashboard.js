"use strict";(self.webpackChunkthebudgeteer=self.webpackChunkthebudgeteer||[]).push([[554],{669:(t,a,e)=>{e.d(a,{default:()=>l});var s=e(501),r=e(933),n=e(681),i=e(99),o=e(438),d=e(17);s.Chart.register(s.ju,s.Bs);class l{#t;#a;initPromise;#e;#s;#r;table;#n;#i;#o;constructor(t,a){this.#t=a,this.initPromise=this.#d(t)}async#d(t){try{this.#a=!0;var a=document.getElementById("antiforgeryToken").value,e=this.#l(t),s=this.#h(a);this.#c(),this.#n=document.getElementById("budget-header"),this.#o=document.getElementById("total-header"),this.#i=document.getElementById("difference-header"),await s,await e,this.table.ajax.reload(null,!1)}finally{this.#a=!1}}#c(){var t={responsive:!0,layout:{padding:2},maintainAspectRatio:!1,plugins:{tooltip:{callbacks:{label:function(t){var a=t.dataset.label||"";return a&&(a+=": "),null!==t.parsed.y&&(a+=window.userNumberFormat.format(t.parsed)),a}}}}},a=document.getElementById("sentimentChart");this.#s=new s.Chart(a,{type:"doughnut",data:{labels:["Happy","Unhappy"],datasets:[{label:"Total Amount",data:[a.dataset.happy,a.dataset.unhappy],backgroundColor:["rgb(25,135,84)","rgb(220,53,69)"],hoverOffset:4}]},options:t});var e=document.getElementById("necessityChart");this.#r=new s.Chart(e,{type:"doughnut",data:{labels:["Necessary","Unnecessary"],datasets:[{label:"Total Amount",data:[e.dataset.necessary,e.dataset.unnecessary],backgroundColor:["rgb(25,135,84)","rgb(220,53,69)"],hoverOffset:4}]},options:t})}async#l(t){this.#e=await(0,r.nz)("#monthSelector","month"),this.#e.datepicker("setDate",t.toISOString()),this.#e.on("changeDate",(async()=>{this.#u(this.#e.datepicker("getUTCDate"))})),d(".monthPicker .calendar-button").on("click",(function(){var t=d(this).siblings(".monthSelector");t.data("datepicker").picker.is(":visible")?t.datepicker("hide"):t.datepicker("show")}))}async#h(t){try{const{default:n}=await e.e(897).then(e.bind(e,374));var a={start:0,lastId:null,lastValue:null},s=this,r=new n("#transactions-table",{processing:!0,serverSide:!0,deferLoading:0,order:[[1,"desc"]],ajax:function(e,r,n){var l=new d.fn.dataTable.Api(n),h=!1,c=null,u=null,m=null,g=null;if(e.order?.[0]&&(m=e.order[0].name,g=e.order[0].dir),0!==e.start){let t=null;a.start!==e.start?t=(h=a.start>e.start)?l.row(":first").data():l.row(":last").data():(c=a.lastId,u=a.lastValue),t&&(c=t.id,m&&(u=t[m]))}var p=s.#e.datepicker("getUTCDate"),y=new Date(Date.UTC(p.getFullYear(),p.getMonth())),f=new Date(Date.UTC(p.getFullYear(),p.getMonth()+1,1));f.setMilliseconds(-1);var b={draw:e.draw,start:e.start,pageSize:e.length,orderBy:m,orderDirection:"asc"===g?0:1,lastId:c,lastValue:u,isPrevious:h,categoryId:s.#t.id,MinDate:y.toISOString(),MaxDate:f.toISOString()};d.ajax({url:i.Q.transactions.GET_SEARCH,type:"POST",contentType:"application/json",headers:{RequestVerificationToken:t},data:JSON.stringify(b),success:function(t){r({draw:t.draw,recordsFiltered:e.start+t.transactions.length+(!0===t.hasNext?1:0),data:t.transactions}),a={start:b.start,lastId:b.lastId,lastValue:b.lastValue}},error:function(t,a,e){o.A.addAndShow("Failed to fetch data.Please try again.","#cross-icon")}})},info:!1,layout:{topStart:null,topEnd:null,bottomStart:"pageLength",bottomEnd:{paging:{type:"simple",numbers:!1}}},lengthMenu:[10,25,50],columns:[{data:"title",render:n.render.text(),name:"title"},{data:"dateTime",name:"dateTime"},{data:"amount",name:"amount"},{data:null,defaultContent:'<div class="d-flex justify-content-center align-items-center flex-wrap gap-2">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="table-icon" tabindex="0" data-icon="edit">\n                            <use href="#edit-icon"/>\n                        </svg >\n                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" class="table-icon" viewBox="0 0 16 16" tabindex="0" data-icon="delete">\n                            <use href="#trash-icon"/>\n                        </svg>\n                    </div>',targets:-1,sortable:!1}],columnDefs:[{targets:2,render:function(t,a,e){return"display"===a?window.userNumberFormat.format(t):t}},{targets:1,render:function(t,a,e){return"display"===a?new Date(t).toLocaleString(window.userLocale):t}}],scrollX:!0,scrollCollapse:!0});this.table=r,document.getElementById("table-container").style="",r.columns.adjust()}catch(t){o.A.addAndShow("A critical error occurred. Please reload the page","#cross-icon",!1)}}async#u(t){try{if(this.#a)return o.A.addAndShow("The dashboard is loading...","#info-icon"),!1;this.#a=!0,this.table.ajax.reload(null,!0);var a=await this.#m(this.#t.id,t,this.#t.categoryType);a.isSuccess?(this.#g(a.data),this.#p(a.data),this.#t=a.data):o.A.addAndShow(a.message,"#cross-icon")}finally{this.#a=!1}}async#m(t,a,e){return await(0,n.Cs)(t,a,e)}#g(t){var a=t??this.#t;return null!=a&&(this.#s.data.datasets[0].data=[a.happyTotal,a.total-a.happyTotal,Number.MIN_VALUE],this.#s.update(),this.#r.data.datasets[0].data=[a.necessaryTotal,a.total-a.necessaryTotal,Number.MIN_VALUE],this.#r.update(),!0)}#p(t){var a=t??this.#t;if(null==a)return!1;var e,s=1===a.categoryType,r=s?"Goal":"Budget",n=s?"Income":"Expenses",i=a.budgetLimit?.budget??a.budget,o=i-a.total;return e=o<0?s?"Surplus":"Overspending":s?"Pending":"Available",this.#n.textContent=`${r}: ${window.userNumberFormat.format(i)}`,this.#o.textContent=`${n}: ${window.userNumberFormat.format(a.total)}`,this.#i.textContent=`${e}: ${window.userNumberFormat.format(Math.abs(o))}`,!0}formatDashboard(t){var a=t??this.#t;return null!=a&&(this.#g(a),this.#p(a),this.table.rows().invalidate().draw(),!0)}addTransaction(t){var a=new Date(t.dateTime),e=a.getYear(),s=a.getMonth(),r=this.getCurrentMonthUTC(),n=r.getYear(),i=r.getMonth();e===n&&s==i&&(this.#t.total+=t.amount,t.isHappy&&(this.#t.happyTotal+=t.amount),t.isNecessary&&(this.#t.necessaryTotal+=t.amount),this.#p(),this.#g(),this.table.ajax.reload(null,!1))}editTransaction(t,a,e,s,r){var n=new Date(t.dateTime);n.getYear()===r.getYear()&&n.getMonth()===r.getMonth()&&(this.#t.total+=a,this.#t.happyTotal+=e*a,this.#t.necessaryTotal+=s*a),this.#t.total-=t.amount,this.#t.happyTotal-=t.isHappy*t.amount,this.#t.necessaryTotal-=t.isNecessary*t.amount,this.#p(),this.#g()}removeTransaction(t){this.#t.total-=t.amount,this.#t.happyTotal-=t.isHappy*t.amount,this.#t.necessaryTotal-=t.isNecessary*t.amount,this.#p(),this.#g()}getCurrentMonthUTC=()=>this.#e.datepicker("getUTCDate");getCurrentMonth=()=>this.#e.datepicker("getDate")}}}]);